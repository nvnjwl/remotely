import{M as l,T as S,$ as L,_ as N}from"./assets/preload-helper-XiwAX_5I.js";const u=new Map,f={connection:{status:"disconnected",targetId:null,selfId:null},logs:[],network:[],storage:{},rrwebEvents:[]};function p(){return f}function i(e,t){const n=e.split(".");let o=f;for(let c=0;c<n.length-1;c++)o=o[n[c]];o[n[n.length-1]]=t,T(e,t)}function E(e){e(f),T("*",f)}function m(e,t){return u.has(e)||u.set(e,new Set),u.get(e).add(t),()=>u.get(e).delete(t)}function T(e,t){u.has(e)&&u.get(e).forEach(n=>n(t)),u.has("*")&&u.get("*").forEach(n=>n(f))}function M(e,t){const n=Math.random().toString(36).slice(2);g.set(n,t),R()?.send(l.CMD,{code:e,id:n})}const g=new Map;function H(e){const{id:t,success:n,value:o,error:c}=e.payload,a=g.get(t);a&&(a({success:n,value:o,error:c}),g.delete(t))}let d=null,h=null;function k(e,t={}){return h=t.secret||null,d=new S(n=>new L(n,t.peer||{}),{onMessage:D,debug:t.debug}),d.init(e),d.onOpen(()=>{C(),i("connection.status","connected")}),i("connection.status","ready"),d}function v(e){if(!d)throw new Error("transport not ready");i("connection.status","connecting"),d.connect(e),setTimeout(()=>{p().connection.status!=="connected"&&i("connection.status","error")},1e4)}function R(){return d}function D(e){if(!(!e||typeof e!="object")){if(e.type===l.HANDSHAKE){if(h&&e.payload?.secret!==h)return;i("connection.status","connected");return}switch(e.type){case l.LOG:E(t=>{t.logs.push(e.payload)});break;case l.NET_REQ:case l.NET_RES:E(t=>{t.network.push(e.payload)});break;case l.STORAGE:i("storage",e.payload);break;case l.RRWEB_EVENT:E(t=>{(t.rrwebEvents||=[]).push(e.payload)});break;case l.CMD_RESULT:H(e);break}}}function C(){h?d?.send(l.HANDSHAKE,{secret:h}):d?.send(l.HANDSHAKE,{})}function $(){const e=document.createElement("div");e.className="status-bar";const t=document.createElement("form");t.className="connect-form",t.innerHTML=`
    <input name="target" placeholder="Target CPID" required />
    <button type="submit">Connect</button>
    <span class="status-dot disconnected" aria-label="status" role="status"></span>
    <span class="status-text">Disconnected</span>
  `;const n=t.querySelector(".status-dot"),o=t.querySelector(".status-text");function c({status:a,targetId:r}){n.className="status-dot "+a,o.textContent=a==="connected"?`Connected to: ${r}`:a==="connecting"?`Connecting to: ${r||""}`:a==="ready"?"Ready for connection":a==="error"?"Connection error":"Disconnected"}return m("connection.status",()=>c(p().connection)),m("connection.targetId",()=>c(p().connection)),t.addEventListener("submit",a=>{a.preventDefault();const r=new FormData(t).get("target");if(i("connection.targetId",r),i("connection.status","connecting"),p().connection.selfId)v(r),setTimeout(()=>C(),500);else{const s="ctrl-"+Math.random().toString(36).slice(2,8);i("connection.selfId",s),k(s,{debug:!1}),setTimeout(()=>{v(r),setTimeout(()=>C(),500)},300)}}),e.appendChild(t),e}function q(){const e=document.createElement("div");e.className="console-panel";const t=document.createElement("ul");t.className="log-list",e.appendChild(t);function n(){t.innerHTML="",p().logs.slice(-200).forEach(o=>{const c=document.createElement("li");c.textContent=`[${o.level}] ${o.message}`,c.className="log-item "+o.level,t.appendChild(c)})}return m("logs",n),e}function x(){const e=document.createElement("div");e.className="network-panel";const t=document.createElement("table");t.className="net-table",t.innerHTML="<thead><tr><th>Method</th><th>URL</th><th>Status</th><th>Time</th></tr></thead><tbody></tbody>";const n=t.querySelector("tbody");e.appendChild(t);function o(){n.innerHTML="",p().network.slice(-300).forEach(c=>{const a=document.createElement("tr");a.innerHTML=`<td>${c.method}</td><td title="${c.url}">${_(c.url,80)}</td><td>${c.status||""}</td><td>${c.duration||""}</td>`,n.appendChild(a)})}return m("network",o),e}function _(e,t){return e.length>t?e.slice(0,t-3)+"...":e}function P(){const e=document.createElement("div");e.className="storage-panel";const t=document.createElement("table");t.innerHTML="<thead><tr><th>Key</th><th>Value</th></tr></thead><tbody></tbody>";const n=t.querySelector("tbody");e.appendChild(t);function o(){n.innerHTML="",Object.entries(p().storage||{}).forEach(([a,r])=>{const s=document.createElement("tr");s.innerHTML=`<td>${w(a)}</td><td>${w(String(r))}</td>`,n.appendChild(s)})}return m("storage",o),e}function w(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function A(){const e=document.createElement("div");e.className="command-panel";const t=document.createElement("form");t.innerHTML=`
    <textarea name="code" placeholder="Enter JS command" rows="5" style="width:100%;"></textarea>
    <div style="margin-top:.5rem; display:flex; gap:.5rem;">
      <button type="submit">Run</button>
      <button type="button" data-action="clear">Clear</button>
    </div>
    <pre class="cmd-result" aria-live="polite"></pre>
  `;const n=t.querySelector(".cmd-result");return t.addEventListener("submit",o=>{o.preventDefault();const c=new FormData(t).get("code");M(c,a=>{n.textContent=a.success?a.value:"Error: "+a.error})}),t.querySelector('[data-action="clear"]').addEventListener("click",()=>{t.querySelector("textarea").value="",n.textContent=""}),e.appendChild(t),e}let y=null;function I(){return y||(y=N(()=>import("./assets/rrweb-DnApGbsL.js"),[]).catch(()=>({}))),y}function O(){const e=document.createElement("div");e.className="replay-panel";const t=document.createElement("div");t.innerHTML='<button data-action="play">Play</button> <button data-action="clear">Clear</button>';const n=document.createElement("div");n.className="rrweb-player",e.appendChild(t),e.appendChild(n);let o=null;async function c(){const a=await I(),r=p().rrwebEvents||[];o&&o.destroy?.(),o=new a.Replayer(r,{root:n}),o.play()}return t.querySelector('[data-action="play"]').addEventListener("click",c),t.querySelector('[data-action="clear"]').addEventListener("click",()=>{o?.destroy?.(),n.innerHTML=""}),m("rrwebEvents",()=>{}),e}function K(){const e=document.createElement("div");e.className="tabs-wrapper";const t=[{id:"console",label:"Console",panel:q},{id:"network",label:"Network",panel:x},{id:"storage",label:"Storage",panel:P},{id:"commands",label:"Commands",panel:A},{id:"replay",label:"Replay",panel:O}],n=document.createElement("div");n.className="tab-bar";const o=document.createElement("div");o.className="tab-panels",t.forEach((a,r)=>{const s=document.createElement("button");s.type="button",s.textContent=a.label,s.dataset.tab=a.id,s.addEventListener("click",()=>c(a.id)),n.appendChild(s);const b=document.createElement("div");b.className="tab-panel",b.dataset.panel=a.id,r===0&&b.classList.add("active"),b.appendChild(a.panel()),o.appendChild(b)});function c(a){o.querySelectorAll(".tab-panel").forEach(r=>r.classList.toggle("active",r.dataset.panel===a)),n.querySelectorAll("button").forEach(r=>r.classList.toggle("active",r.dataset.tab===a))}return e.appendChild(n),e.appendChild(o),e}function j(e=document.body){const t=document.createElement("div");t.id="remote-debugger",t.appendChild($()),t.appendChild(K()),e.appendChild(t)}window.addEventListener("DOMContentLoaded",()=>{j(),new URLSearchParams(location.search).get("secret")});
